<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/changePage.css">
    <script src="js/ajax.js"></script>
    <script src="js/commonFunction.js"></script>
</head>

<body>
    <div class="container">
        <ul class="list"></ul>
    </div>

    <ol class="page-change" id="btn">
        <span class="last" style="visibility:visible;"> &lt; 上一页</span>
        <ul id="main" class="main">

        </ul>
        <span class="next" style="visibility:visible; ">下一页 &gt; </span>
    </ol>



    <script>
    

        class Pages {
            // 默认配置
            static option = {
                // 每页显示数据条数（必填）
                limit: 5,
                // 数据总数
                count: 10,
                // 当前页码（选填，默认为1）
                curr: 1,
                // 当前页前后两边可显示的页码个数（选填，默认为2）
                pageShow: 2,
            }

            constructor(node, DataOptions) {
                //获取父元素
                this.container = document.getElementById(node);
                //获取对应节点
                this.list = this.container.querySelector('.main');
                this.nextBtn = this.container.querySelector('.next');
                this.pveBtn = this.container.querySelector('.last');
                //将默认数据和输入输入数据合并
                this.option = Object.assign(Pages.option, DataOptions);
                // currArray代表目前出现的页码
                this.currArray = [];
                //初始化数据
                this.init();
                // this.showPages();

            }


            showPage() {
                this.currArray = [];
                const showOption = this.option;
                //第一种情况：当前页码还没到中间,处于左侧·
                if (showOption.curr < showOption.pageShow + 1) {
                    for (let i = 1; i <= showOption.pageShow * 2 + 1; i++) {
                        this.currArray.push(i);
                    }
                    //第二种情况：当前页码大于中间，处于右侧
                } else if (showOption.curr > showOption.count - showOption.pageShow) {
                    for (let i = showOption.count - showOption.pageShow * 2; i <= showOption.count; i++) {
                        this.currArray.push(i);
                    }
                } else {
                    for (let i = showOption.curr - showOption.pageShow; i <= showOption.curr + showOption.pageShow; i++) {
                        this.currArray.push(i);
                    }
                }

            }

            changePage() {

                let pageElement = this.container;
                //通过事件委派实现页码变化
                pageElement.addEventListener('click', (e) => {
                    let target = e.target;
                    if (target.tagName.toLowerCase() == 'li') {
                        //让其他item样式去掉
                        this.goPage(parseInt(target.innerHTML));
                    }
                    else if (target.className.toLowerCase() == 'next') {
                        this.nextPage();
                    }
                    else if (target.className.toLowerCase() == 'last') {
                        this.pvePage();
                    }
                })
            }
            //初始化分页表，跳转页码的主要函数
            initPage() {
                // 让页码全部清空
                this.list.innerHTML = '';
                //消除所有页码的点击样式（排他思想）
                clearOther(this.list, 'current');

                //把当前要显示的页码添加到数组中 currArray
                this.showPage();

                //判断下一页和上一页的按钮是否需要隐藏（第一页和最后一页需要隐藏）
                if (this.option.curr == 1) {
                    this.pveBtn.style.visibility = 'hidden';
                }
                else if (this.option.count == this.option.curr) {
                    this.nextBtn.style.visibility = 'hidden';
                }
                else {
                    this.nextBtn.style.visibility = 'visible';
                    this.pveBtn.style.visibility = 'visible';
                }

                // 通过循环将页码添加到页码当中
                const fragment = document.createDocumentFragment();
                for (let i = 0; i < this.currArray.length; i++) {
                    let li = document.createElement('li');
                    li.innerHTML = this.currArray[i];
                    if (this.currArray[i] == this.option.curr)
                        li.classList.add('current');
                    fragment.appendChild(li);
                }
                this.list.append(fragment);
            }
            goPage(num) {
                this.option.curr = num;
                this.initPage();
            }
            pvePage() {
                this.option.curr--;
                this.initPage();

            }

            nextPage() {
                this.option.curr++;
                this.initPage();


            }


            init() {
                //初始化数据
                this.showPage();
                //初始化生成
                this.initPage();
                // 改变页数并触发事件
                this.changePage();
            }
        }
        
        //btn为添加的位置的id
        new Pages('btn', {
            // 数据总数
            count: 10,
            // 当前页码（选填，默认为1）
            curr: 1,
            pageShow: 3,
            // 当前页前后两边可显示的页码个数（选填，默认为2）
        })



    </script>
</body>

</html>